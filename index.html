<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calling It In!</title>
<link rel="canonical" href="https://www.callingit.in">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
<link rel="stylesheet" href="/screen.css">
</head>
<body class="has-background-light">

<section class="section">
    <div class="container">
        <h1 class="title has-text-centered">
            Calling It In!
        </h1>

        <div class="subtitle has-text-centered">
            A stand-alone puzzle answer checker
        </div>
        <p class="block">
            Create a unique URL that you can share with your solvers, so they can check the answer without being spoiled. Simply enter the correct answer and the title of your puzzle below.
        </p>


        <div class="box">
            <form id="gen">
            <div class="field">
                <label class="label">Correct answer</label>
                <input class="input" type="text" id="gen-input">
            </div>
            <div class="field">
                <label class="label">Puzzle title</label>
                <input class="input" type="text" id="gen-label">
            </div>
            <button type="submit" class="button is-link">Generate URL</button>
            <br>
            <br>
            </form>
        </div>

        <div class="box"><p id="gen-outer"><span id="gen-out"></span><a id="gen-link"></a></p></div>

    </div>
</section>

<form id="check"></form>

<footer class="footer has-background-info-dark has-text-white">
  <div class="content has-text-centered">
    <p>
      A <a href="https://www.mysteryleague.com">The Mystery League</a> project.
      <br>
      Code by <a href="https://www.puzzlehunt.net/checker">betaveros</a>, used with permission and gratitude.<br>
    </p>
  </div>
</footer>

<script type="text/javascript" src="/scrypt.js"></script>
<script type="text/javascript" src="/code.js"></script>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    const genForm = document.getElementById('gen');
    const genOuter = document.getElementById('gen-outer');
    const genOut = document.getElementById('gen-out');
    const genInput = document.getElementById('gen-input');
    const genLink = document.getElementById('gen-link');

    genForm.addEventListener('submit', function (event) {
        event.preventDefault();
        const answer = canonicalize(genInput.value);
        genOuter.className = 'padded-callout';
        genOut.textContent = 'Generating...';
        genLink.textContent = '';
        genLink.href = '#';
        const genLabel = b64OfArray(encoder.encode(document.getElementById('gen-label').value));
        generateHash(genLabel, answer, function (v) {
            if ('error' in v) {
                genOuter.className = 'padded-callout error';
                genOut.textContent = 'Error: ' + v.error;
                genLink.textContent = '';
                genLink.href = '#';
            } else if ('version' in v && 'salt' in v && 'hash' in v) {
                genOuter.className = 'padded-callout success';
                genOut.textContent = "Here's your unique URL for " + answer + ': ';
                const url = location.protocol + '//' + location.host + '/' + v.version + '/#' + [v.salt, v.hash, genLabel].join('#');
                genLink.textContent = url;
                genLink.href = url;
            } else if ('progress' in v) {
                genOut.textContent = 'Generating (' + Math.floor(v.progress * 100) + '%)...';
                genLink.textContent = '';
                genLink.href = '#';
            }
        });
    });

    genForm.style.display = "block";
});
</script>
</body>
</html>